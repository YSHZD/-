<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Document</title>
</head>
<body>
	1.<canvas canvas-id="photo_canvas" style="width:{{canvasWidth}}px;height:{{canvasHeight}}px;position: absolute;left:-3000px;top:-300px;"></canvas> 
	   data:  {
	          canvasWidth:0,
                  canvasHeight:0
	  }
	2. compress(that.data.uploadlog, function (data){console.log(data)})
      //url 图片选择后的路径  callback 回调函数 知道压缩完返回图片路径
       function compress(url,callback){
        //最大尺寸的设置
        let MAXSIZE = 600;
        wx.getImageInfo({
        src: url,
        success: function (res) {
        var ctx = wx.createCanvasContext('photo_canvas');
        var canvasWidth = res.width
        var canvasHeight = res.height;
        // console.log(canvasWidth)
        // console.log(canvasHeight)
        if (canvasWidth > MAXSIZE && canvasWidth >= canvasHeight) {
          //比例取整
          canvasWidth = MAXSIZE
          canvasHeight = Math.floor(res.height * MAXSIZE / canvasWidth)
        } else if (canvasHeight > MAXSIZE && canvasHeight > canvasWidth){
          canvasWidth = Math.floor(res.width * MAXSIZE / canvasHeight)
          canvasHeight = MAXSIZE
        }
        // console.log(canvasWidth)
        // console.log(canvasHeight)
        that.setData({
          canvasWidth: canvasWidth,
          canvasHeight: canvasHeight
        })//设置canvas尺寸
        ctx.drawImage(url, 0, 0, canvasWidth, canvasHeight)
        ctx.draw()
        //下载canvas图片
        setTimeout(function () {
          wx.canvasToTempFilePath({
            canvasId: 'photo_canvas',
            success: function (res) {
              //返回压缩后的路径
              callback(res.tempFilePath)
            },
            fail: function (error) {
              console.log(error)
            }
          })
        }, 100)
        } ,
        fail: function (error) {
          console.log(error)
        }
        })
      }
</body>
</html>
